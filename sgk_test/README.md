# Справочная информация о работе скрипта

Действия скрипта:

* **проверка версии ядра и его обновление в случае отсутствия актуального**;

Обновление проверяется по средством uname. Обновление происходит утилитой astra-update при её наличии в репозитории, иначе утилитой apt dist-upgrade. После обновление будет произведено копирование boot раздела на соответсвующие диски.

* **проверка наличия необходимых пакетов для правильной работы ОПО и их установка в случаи отсутствия**;

При их отсутствии будет произведена установка из репозитория-флешки или локального deb пакета по средствам утилиты dpkg.

* **проверка наличия запущенных сервисов ОПО и их запуск в случаи отсутствия**;

Запуск производится утилитой systemctl.

* **проверка наличия сервисов ОПО в автозагрузке и их добавление в случаи отсутствия**;

Запуск производится утилитой systemctl.

* **проверка наличие и работоспособность RAID (с/без горячей замены)**;

Проверка производиться с помощью утилиты mdadm. Проверяется факт наличия, уровень, состояние, нахождение в fstab

* **проверка состояния постоянного хранилища (HDD, SSD)**;

Проверка наличия ошибок на постоянных хранилищах, которые подключены по SATA. Диагностика производиться утилитой smartctl.

* **проверка состояния ЗПС и его включение в случае нахождения его в выключенном состоянии**;

Проверяется факт включения ЗПС. При его отсутствии производится включение с помощью конфигурационного файла и обновление ядра. После включения будет произведено копирование boot раздела на соответсвующие диски.

* **проверка состояния режима Full HD для монитора и его настройка в случае отсутствия**;

Копирование на СВТ файла 10-monitors.conf в папку X сервера.

* **настройка сетевых параметров**;

Производится согласно IP плану (файлу sgk_ipplan.csv): для арма настройка происходит утилитой nmcli, для сервера происходит запись в файл interfaces.
Определение рабочего интерфейса происходит с помощью файла static_interfaces.csv
``` 
auto lo
iface lo inet loopback

auto eth0
iface eth0 inet static
address 10.2.0.3
netmask 255.255.255.0
gateway 10.2.0.1


auto eth1
iface eth1 inet manual

auto eth2
iface eth1 inet manual

auto eth3
iface eth1 inet manual
``` 

* **установка пакета антивируса Касперский**;

Установка пакета kesl-astra.

* **Импортирование ключей цифровой подписи СПО**;

Проверяется и в последующем импортируются ключи СПО: Kaspersky, КП УИБ, DR WEB, ПИ АУС, КРИПТО ПРО. После включения будет произведено копирование boot раздела на соответсвующие диски. В случае лишних ключей, происходит их удаление.

* **Настройка localadm пользователя**;

Перемеинование пользователя admin в localadm. Переименование происходить путём смены имени в passwd, group, shadow, смены папки пользователя с последующим обнулением мандатных меток и присвоением высокого уровня целостности.

* **Настройка репозитория**;

Настройка файла репозитория в соответствии с инструкцией по установке репозиториев (файла repository.json).

* **Настройка ntp**;

Настройка списка серверов для синхронизации времени происходит копированием файла ntp.conf на СВТ.

* **Настройка dns серверов**;

Настройка списка dns серверов происходит копированием файла resolv.conf на СВТ

* **Настройка агрегации (bonding 1)**.

Устанавливается пакет ifenslave и записывает изменения в файл interfaces. Проверка бондига происходит через файл bonding.list
``` 
auto lo
iface lo inet loopback

auto eth0
iface eth0 inet manual

auto eth1
iface eth1 inet manual

auto bond0
iface bond0 inet static
address 10.2.0.3
netmask 255.255.255.0
gateway 10.2.0.1
bond-mode 1
bond-miimon 100
bond-downdelay 200
bond-updelay 200
bond-xmit-hash-policy 1
slaves eth0 eth1
```

* **Копирование скрипта sgk_essential в папку /usr/doc**;

С предварительным удалением лишних IP адресов в CSV

* **Очистка мусорных папок, файлов и программ, добавленных ИНЭУМ**;

# Параметры запуска
```
./sgk_test [HOSTNAME] [serial_number] [date_end_key_APMDZ]
```
Дата окончания действия ключа АПМДЗ вводится в формате: **dd-mm-YYYY**

Имя СВТ имеет следующий вид (регулярное выражение): **^[a-z0-9\-]+.(potu|pou).su$**

Серийный номер имеет следующий вид (регулярное выражение): **^[0-9]{4}И$**